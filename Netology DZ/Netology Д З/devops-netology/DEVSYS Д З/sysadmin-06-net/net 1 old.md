# Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

# Задание 1

Необязательное задание:


можно посмотреть целый фильм в консоли `telnet towel.blinkenlights.nl` :)

# Ответ:

Не люблю звёздные войны и к сожелению не знаю английский 

# Задание 2.

Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.

# Ответ:

WiFi  на 2.4 ГГц

Всего 14 каналов и только 3 непересекаются  1.6.11 при ширне канала = 40 МГц


WiFi  на 5 ГГц

В России 17  непересекающихся каналов  20 МГц 
Стандартами Wi-Fi предусмотрено использование каналов шириной в 40 МГц, 80 МГц и 160 МГц. 
Широкие полосы могут использоваться только в полосах UNII.
Таким образом каждая из доступных в России полос может содержать по 4 канала 20 МГц, 2 канала 40 МГц и по одному каналу 80 МГц.
Канал шириной в 160 МГц может использоваться только один, получаемый при объединении полос UNII-1 и UNII-2 - занимая всю их ширину.




# Задание 3. 

Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?

# Ответ:

Производитель сетевого устройства с MAC `38:f9:d3:55:55:79: компания Apple

# Задание 4. 

Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?

# Ответ:

payload TCP будет = 8981

# Задание 5. 

Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет ?


# Ответ:

Нет не могут . Комбинация флага SYN и FIN, устанавливаемого в заголовке TCP, является недопустимой и относится к категории комбинации недопустимого / ненормального флага, поскольку она требует как установления соединения (через SYN), так и прекращения соединения (через FIN).


# Задание 6. 

`ss -ula sport = :53` на хосте имеет следующий вывод:

```bash
State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
```

Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?

# Ответ:

UNCONN - соединение не установлено

TIME-WAIT-Состояние TIME_WAIT является механизмом защиты в TCP. 

Сторона, которая упорядоченно закрывает соединение с сокетом, будет поддерживать соединение в состоянии TIME_WAIT в течение некоторого времени, обычно от 1 до 4 минут. 

Это происходит после закрытия соединения. 

Это не указывает на проблему с очисткой. 

Состояние TIME_WAIT защищает от потери и повреждения данных.

-u - флаг UDP 

UDP- не использует проверки (в отличии от TCP)  ему не нужно время для разрыва сессии



# Задание 7.

Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.

# Ответ:

                                     Client                 Server
                                   ESTABLESHED            ESTABLESHED
                                   Connection             Connection
    Step 1 (FIN From Client)       FIN_WAIT_1             CLOSE_WAIT     
    Step 2 (FIN-ACC from Server)   FIN_WAIT_2             CLOSE_WAIT
    Step 3 (ACK from Client)       TIME WAIT              LAST ACK
                                   Closed                 Closed

# Задание 8

TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?


# Ответ:

Максимальное число портов 65535  но это в теории по факту наверно нехватит других ресурсов ОS

# Задание 9

Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.


# Ответ:

Может при частом соединении и отключении соединения

Скорее это плохо так как возможна ситуация что кончатся порты TCP у приложения

# Задание 10

Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

# Ответ:

Плюсы UDP (на примере видеонаблюдения или SIP ) это скорость работы 
Минусы UDP  (на примере видеонаблюдения или SIP ) это возможные артифакты в видео и прерывания в аудио

ТСP проивоположно  UDP

# Задание 11

Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.

# Ответ:

Использовал бы TCP ,так как есть контроль доставки , а доли секунды здесь не так важны.

syslog отказался от UDP в пользу TCP 

В современном мире сильно увеличилась скорость обработки даже видеонаблюдение используя TCP имеет минимальные задержки

В UDP получается выше скороть канала но она зачастую не нужна 

# Задание 12

Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?

# Ответ:

6 портов IPV4 systemd,rpcbind,systemd-resolve,netdata,sshd  

5 портов IPV6 systemd,rpcbind,netdata,sshd ,node_exporter 

```bash

root@vagrant:/home/vagrant#  lsof -n -itcp -stcp:listen
COMMAND    PID            USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
systemd      1            root   35u  IPv4  16217      0t0  TCP *:sunrpc (LISTEN)
systemd      1            root   37u  IPv6  16624      0t0  TCP *:sunrpc (LISTEN)
rpcbind    578            _rpc    4u  IPv4  16217      0t0  TCP *:sunrpc (LISTEN)
rpcbind    578            _rpc    6u  IPv6  16624      0t0  TCP *:sunrpc (LISTEN)
systemd-r  579 systemd-resolve   13u  IPv4  18299      0t0  TCP 127.0.0.53:domain (LISTEN)
netdata    809         netdata    4u  IPv4  24286      0t0  TCP *:19999 (LISTEN)
netdata    809         netdata   35u  IPv6  24392      0t0  TCP [::1]:8125 (LISTEN)
netdata    809         netdata   36u  IPv4  24393      0t0  TCP 127.0.0.1:8125 (LISTEN)
sshd       829            root    3u  IPv4  23409      0t0  TCP *:ssh (LISTEN)
sshd       829            root    4u  IPv6  23411      0t0  TCP *:ssh (LISTEN)
node_expo 1357   node_exporter    3u  IPv6  29309      0t0  TCP *:9100 (LISTEN)

```

# Задание 13

 Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?

# Ответ:

tcpdump -A выдаёт в ASCII 

```bash
root@vagrant:/home/vagrant# sudo tcpdump -A -c 1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
20:52:35.901502 IP vagrant.ssh > _gateway.49976: Flags [P.], seq 1189028068:1189028232, ack 2198199, win 62780, length 164
E.....@.@.AQ
...
......8F. ..!..P..<.....i.8..&.E...Q.wo.1..;BA..=.H.v..n.........St..7n7..y..c..S.h..e.N&..3`........V.-.......kT..(......6A......k#2..HLel@....~.I.Fa....I.&t.Zc8...1n...O.d.....c.+...l{.
1 packet captured
10 packets received by filter
0 packets dropped by kernel
root@vagrant:/home/vagrant#
```
tcpdump -x - выведет в hex

```bash
root@vagrant:/home/vagrant# tcpdump -x -c 1
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
20:54:53.151478 IP vagrant.ssh > _gateway.49976: Flags [P.], seq 1189029908:1189029944, ack 2198939, win 62780, length 36
        0x0000:  4510 004c e0e8 4000 4006 41a3 0a00 020f
        0x0010:  0a00 0202 0016 c338 46df 2814 0021 8d9b
        0x0020:  5018 f53c 184f 0000 085b 64d6 665c 4222
        0x0030:  e5ce f00b 1f32 5f9c 35fb 165b a845 8fb1
        0x0040:  2a48 580d 756f 72ea a831 1217
1 packet captured
10 packets received by filter
0 packets dropped by kernel
root@vagrant:/home/vagrant#
```


# Задание 14

 Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?

# Ответ:

Ethernet называется Ethernet II

0: Зарезервирован, должен быть равен 0

1: Не фрагментировать

2: У пакета ещё есть фрагменты


```bash

Internet Protocol Version 4, Src: 10.0.2.2, Dst: 10.0.2.15
    0100 .... = Version: 4
    .... 0101 = Header Length: 20 bytes (5)
    Differentiated Services Field: 0x00 (DSCP: CS0, ECN: Not-ECT)
        0000 00.. = Differentiated Services Codepoint: Default (0)
        .... ..00 = Explicit Congestion Notification: Not ECN-Capable Transport (0)
    Total Length: 40
    Identification: 0x0e0e (3598)
    Flags: 0x0000
        0... .... .... .... = Reserved bit: Not set
        .0.. .... .... .... = Don't fragment: Not set
        ..0. .... .... .... = More fragments: Not set
    Fragment offset: 0
    Time to live: 64
    Protocol: TCP (6)
    Header checksum: 0x54b2 [validation disabled]
    [Header checksum status: Unverified]
    Source: 10.0.2.2
    Destination: 10.0.2.15
```

OUI можно увидеть в  Ethernet пакете. первая половина MAC адреса. 

08:00:27:00:00:00   Virtual Machine
Oracle VirtualBox 5.2

```bash
Ethernet II, Src: PcsCompu_73:60:cf (08:00:27:73:60:cf), Dst: RealtekU_12:35:02 (52:54:00:12:35:02)
    Destination: RealtekU_12:35:02 (52:54:00:12:35:02)
        Address: RealtekU_12:35:02 (52:54:00:12:35:02)
```